<!DOCTYPE html>
<html>
<head>
    <title>Chatbot Study</title>

    <!-- Eliza Script -->
    <script src="Eliza.js"></script>

    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/5.8.2/firebase.js"></script>

    <style>
        /* General Stuff */
        body {
            background-color: white;
            color: black;
            font-family: Verdana, Geneva, sans-serif;
            overflow: hidden;
        }

        /* Slideshow container */
        .slideshow-container {
            width: 100%;
            max-width: 1200px;
            height: 100vh;
            position: relative;
            margin: auto;
        }

        /* iFrame container */
        .iframe-container {
            display: none;
            width: 90%;
            height: 90%;
            position: relative;
            overflow: scroll;
            margin: auto;
            border-style: solid;
            border-width: 3px;
            border-color: black;
        }

        .start-text {
            width: 90%;
            position: relative;
            margin: auto;
            padding: 0 5%;
        }

        /* Hide welcome windows in the beginning*/
        .myWelcome {
            display: none;
        }

        .numbertext {
            font-weight: bold;
            font-size: 22px;
            font-variant: small-caps;
            text-align: center;
            width: 100%;
            padding-top: 20px;
            padding-bottom: 25px;
            border-bottom-style: solid;
            background-color: black;
            color: white;
        }

        .greeting {
            font-weight: bold;
            font-size: 22px;
            font-variant: small-caps;
            text-align: center;
            padding-top: 20px;
            padding-bottom: 25px;
            border-bottom-style: solid;
            color: white;
            background-color: white;
            color: black;
            width: 96%;
            margin: 0 2%;
        }

        .warning {
            color: red;
            display: none;
        }


        /* Start Button*/
        .start {
            cursor: pointer;
            padding: 4px 8px;
            text-align: center;
            max-width: 100px;
            background-color: black;
            color: white;
            font-variant: small-caps;
            font-size: 18px;
            transition: 0.6s ease;
            border-radius: 3px;
        }

        /* Next & previous buttons */
        .prev, .next {
            cursor: pointer;
            position: absolute;
            top: 50%;
            width: 5%;
            padding: 16px 0;
            text-align: center;
            margin-top: -22px;
            color: white;
            font-weight: bold;
            font-size: 18px;
            transition: 0.6s ease;
            border-radius: 3px 0 0 3px;
            user-select: none;
            background-color: black;
            display: none;
        }

        /* Position the "next button" to the right */
        .next {
            right: 0;
            border-radius: 0 3px 3px 0;
        }

            /* On hover, add a black background color with a little bit see-through */
            .prev:hover, .next:hover, .start:hover {
                background-color: rgba(0,0,0,0.5);
                color: black;
            }

        iframe {
            width: 100%;
            min-height: 100%;
            left: 0;
            top: 80px;
            position: absolute;
            border-style: none;
        }


        /* Slider Design */
        .slider {
            -webkit-appearance: none;
            width: 200px;
            height: 15px;
            background: #d3d3d3;
            outline: none;
            opacity: 0.7;
            -webkit-transition: .2s;
            transition: opacity .2s;
        }

            .slider:hover {
                opacity: 1;
            }

            .slider::-webkit-slider-thumb {
                -webkit-appearance: none;
                appearance: none;
                width: 15px;
                height: 25px;
                background: black;
                cursor: pointer;
            }

            .slider::-moz-range-thumb {
                width: 15px;
                height: 25px;
                background: black;
                cursor: pointer;
            }            
    </style>
</head>
<body onload="setup()">

    <div class="slideshow-container">

        <!-- WELCOME SCREEN -->
        <div class="iframe-container" id="welcome">
            <div class="myWelcome" id="firstWelcome">

                <div class="greeting">Research study “Chat Study 2019”: information for participants</div>
                <div class="start-text">
                    <p>
                        We would like to invite you to be part of this research project, if you would like to. You should only agree to take part if you want to, it is entirely up to you. If you choose not to take part there won’t be any disadvantages for you and you will hear no more about it.<br>
                        Please read the following information carefully before you decide to take part; this will tell you why the research is being done and what you will be asked to do if you take part. Please ask if there is anything that is not clear or if you would like more information by contacting Anna Nagele on a.n.nagele@qmul.ac.uk.<br>
                        If you decide to take part, on the next page you will be asked to tick a box that confirms that you agree.<br>
                        You are still free to withdraw at any time and without giving a reason by simply leaving the study.<br><br>
                        We are conducting this research as part of the postgraduate module “Research Methods” at Queen Mary University London. Our task is to recreate a successful study based on the published results. In this study you will be chatting online to a range of entities and will be asked to rate them based on their conversational ability. We will then aggregate the collected data to draw conclusions on the entities’ abilities to have conversations.<br><br>
                        We do not  take responsibility for the entities’ responses in the conversations. We will not store any content of your conversations but might be recorded by the entities themselves.<br><br><br>
                        Instructions<br><br>
                        You will be presented with X entities, one at a time. Please chat to each entity and give them a score from 0 . poor/machinelike 100 . human/humanlike for conversation ability.Please give at least 3 min for each chat, you may have as many interactions with each entity as you wish and time allows you. <br><br>
                        It is up to you to decide whether or not to take part. If you do decide to take part please click “Next”. You will be asked to confirm your consent on the next page.<br><br>
                        If you have any questions or concerns about the manner in which the study was conducted please, in the first instance, contact the researchers responsible for the study (Kavaz E. - e.kavaz@se18.qmul.ac.uk, Nagele A.N. - a.n.nagele@qmul.ac.uk, Loebbers S. - s.lobbers@qmul.ac.uk, Zayas Garin L. - l.zayasgarin@qmul.ac.uk).  If this is unsuccessful, or not appropriate, please contact the Secretary at the Queen Mary Ethics of Research Committee, Room W104, Queen’s Building, Mile End Campus, Mile End Road, London or research-ethics@qmul.ac.uk.
                    </p>
                    <div class="start" onclick="nextWelcome()">Next</div>
                </div>
            </div>

            <div class="myWelcome">
                <div class="greeting">Consent agreement</div>
                <div class="start-text">
                    <p>
                        Please give your consent below after you have read the Participant Information about the research on the previous page. <br><br>
                        Title of Study: Chat Study 2019<br>
                        Queen Mary Ethics of Research Committee Ref: ________________<br><br>
                        <ul>
                            <li>Thank you for considering taking part in this research. The people organizing the research must explain the project to you before you agree to take part. </li>
                            <li>If you have any questions arising from the Participant Information  or other  explanation already given to you, please ask the researchers before you decide whether to join in.</li>
                            <li>I understand that if I decide at any other time during the research that I no longer wish to participate in this project, I can withdraw from it immediately by simply closing the page or leaving the survey.</li>
                            <li>I consent to the processing of my personal information for the purposes of this research study. I understand that such information will be treated as strictly confidential and handled in accordance with the provisions of the Data Protection Act 1998.</li>
                            <li>I confirm to be age 18 or older.</li>
                            <li>I agree that the research project named above has been explained to me to my satisfaction and I agree to take part in the study. I have read both the notes written above and the Participant Information on the previous page about the project, and understand what the research study involves.</li>
                        </ul>
                    </p>

                    <div class="start" onclick="nextWelcome()">I agree</div>
                </div>
            </div>

            <div class="myWelcome">
                <div class="greeting">Personal Information</div>
                <div class="start-text">
                    <p>
                        Please enter some of your personal information below. These are required for analysing the study data. <br>
                    </p>
                    <form name="submit-to-google-sheet" action="mailto:someone@example.com" method="post" enctype="text/plain" id="survey">
                        <b id="gender">Gender</b><br>
                        <input type="radio" name="gender" id="male" value="male">
                        <label for="male">Male</label><br>


                        <input type="radio" name="gender" id="female" value="female">
                        <label for="female">Female</label><br>

                        <input type="radio" name="gender" id="other" value="other">
                        <label for="other">Other</label><br>

                        <input type="radio" name="gender" id="prefernottosay" value="prefernottosay">
                        <label for="other">Prefer not to Say</label><br><br>

                        <b>Age</b><br>
                        <select name="age">
                            <option value="18-25">18-25</option>
                            <option value="25+">25+</option>
                        </select><br><br>

                        <b id="language">Is English your native language?</b><br>
                        <input type="radio" name="language" id="yesEng" value="yes">
                        <label for="yesClever">Yes</label><br>

                        <input type="radio" name="language" id="noEng" value="no">
                        <label for="noClever">No</label><br><br>

                    </form>
                    <div class="warning" id="warning1">Please fill in all the fields!</div>
                    <div class="start" onclick="startStudy()">Start</div>
                </div>
            </div>
        </div>

        <!-- BOTS AND SURVEY -->
        <div class="iframe-container" id="bots">


            <!-- ELIZA -->
            <!-- BOT -->
            <div class="mySlides">

                <div class="numbertext" id="bot1">1/3</div>

                <div class="start-text">
                    <table cellspacing="0" cellpadding="2" border="0" align="center" class="neurotoy">
                        <tbody>
                            <tr>
                                <td bgcolor="#FFFFFF">
                                    <form name="Eliza" onsubmit="return dialog();">
                                        <textarea rows="14" cols="55" name="log"></textarea>
                                        <center>

                                            <input type="text" size="50" name="input" value="">
                                            <input type="submit" value="enter">
                                        </center>
                                    </form>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

            </div>

            <!-- SURVEY -->
            <div class="mySlides">

                <div class="numbertext" id="survey1">1/3</div>
                <div class="start-text">

                    <b>Conversational ability score </b> <p> 0 = ‘poor’ machinelike, 50 = ‘good’ (but machinelike), 100 = humanlike)</p>
                    <input form="survey" type="range" class="slider" name="scoreEliza" id="sliderEliza" min="0" max="100" value=""><p>Value: <span id="slideroutputEliza"></span></p><br>

                    <script>
                        var sliderEliza = document.getElementById("sliderEliza");
                        var outputEliza = document.getElementById("slideroutputEliza");
                        outputEliza.innerHTML = sliderEliza.value;

                        sliderEliza.oninput = function() {
                        outputEliza.innerHTML = this.value;
                            }
                    </script>

                    <b>Did the entity express emotions appropriately? </b><br>
                    <input form="survey" type="radio" name="emotionEliza" id="yesEliza" value="yes">
                    <label for="yesEliza">Yes</label><br>

                    <input form="survey" type="radio" name="emotionEliza" id="noEliza" value="no">
                    <label for="noEliza">No</label><br><br>

                    <b>Comments</b><br>
                    <textarea form="survey" name="commentEliza" rows="14" cols="55" id="commentEliza"></textarea><br>

                </div>

            </div>


            <!-- CLEVERBOT -->
            <!-- BOT -->
            <div class="mySlides">

                <div class="numbertext" id="bot2">2/3</div>

                <iframe src="https://www.cleverbot.com/en/basic.php" style="margin-top: -200px">
                    <p>Your browser does not support iframes.</p>
                </iframe>
            </div>

            <!-- SURVEY -->
            <div class="mySlides">

                <div class="numbertext" id="survey2">2/3</div>
                <div class="start-text">

                    <b>Conversational ability score </b> <p> 0 = ‘poor’ machinelike, 50 = ‘good’ (but machinelike), 100 = humanlike)</p>
                    <input form="survey" type="range" class="slider" name="scoreClever" id="sliderClever" min="0" max="100" value=""><p>Value: <span id="slideroutputClever"></span></p><br>

                    <script>
                        var sliderClever = document.getElementById("sliderClever");
                        var outputClever = document.getElementById("slideroutputClever");
                        outputClever.innerHTML = sliderClever.value;

                        sliderClever.oninput = function() {
                        outputClever.innerHTML = this.value;
                            }
                    </script>

                    <b>Did the entity express emotions appropriately? </b><br>
                    <input form="survey" type="radio" name="emotionClever" id="yesClever" value="yes">
                    <label for="yesClever">Yes</label><br>

                    <input form="survey" type="radio" name="emotionClever" id="noClever" value="no">
                    <label for="noClever">No</label><br><br>

                    <b>Comments</b><br>
                    <textarea form="survey" name="commentClever" rows="14" cols="55" id="commentClever"></textarea><br>

                </div>

            </div>




            <!-- Mitsuku -->
            <!-- BOT -->
            <div class="mySlides">

                <div class="numbertext" id="bot3">3/3</div>

                <iframe src="https://kakko.pandorabots.com/pandora/talk?botid=c51abb983e345a1d&skin=ucl">
                    <p>Your browser does not support iframes.</p>
                </iframe>
            </div>

            <!-- SURVEY -->
            <div class="mySlides">

                <div class="numbertext" id="survey3">3/3</div>
                <div class="start-text">

                    <b>Conversational ability score </b> <p> 0 = ‘poor’ machinelike, 50 = ‘good’ (but machinelike), 100 = humanlike)</p>
                    <input form="survey" type="range" class="slider" name="scoreMitsuku" id="sliderMitsuku" min="0" max="100" value=""><p>Value: <span id="slideroutputMitsuku"></span></p><br>

                    <script>
                        var sliderMitsuku = document.getElementById("sliderMitsuku");
                        var outputMitsuku = document.getElementById("slideroutputMitsuku");
                        outputMitsuku.innerHTML = sliderMitsuku.value;

                        sliderMitsuku.oninput = function() {
                        outputMitsuku.innerHTML = this.value;
                            }
                    </script>

                    <b>Did the entity express emotions appropriately? </b><br>
                    <input form="survey" type="radio" name="emotionMitsuku" id="yesMitsuku" value="yes">
                    <label for="yesMitsuku">Yes</label><br>

                    <input form="survey" type="radio" name="emotionMitsuku" id="noMitsuku" value="no">
                    <label for="noMitsuku">No</label><br><br>

                    <b>Comments</b><br>
                    <textarea form="survey" rows="14" cols="55" id="commentMitsuku" name="commentMitsuku"></textarea><br>

                </div>

            </div>

            <!-- UltraHal -->
            <!-- BOT -->
            <div class="mySlides">

                <div class="numbertext" id="bot4"></div>

                <iframe src="https://www.ultrahal.com/hal/plain/chat">
                    <p>Your browser does not support iframes.</p>
                </iframe>
            </div>

            <!-- SURVEY -->
            <div class="mySlides">

                <div class="numbertext" id="survey4"></div>
                <div class="start-text">

                    <b>Conversational ability score </b> <p> 0 = ‘poor’ machinelike, 50 = ‘good’ (but machinelike), 100 = humanlike)</p>
                    <input form="survey" type="range" class="slider" name="scoreHal" id="sliderHal" min="0" max="100" value=""><p>Value: <span id="slideroutputHal"></span></p><br>

                    <script>
                        var sliderHal = document.getElementById("sliderHal");
                        var outputHal = document.getElementById("slideroutputHal");
                        outputHal.innerHTML = sliderHal.value;

                        sliderHal.oninput = function() {
                        outputHal.innerHTML = this.value;
                            }
                    </script>

                    <b>Did the entity express emotions appropriately? </b><br>
                    <input form="survey" type="radio" name="emotionHal" id="yesHal" value="yes">
                    <label for="yesHal">Yes</label><br>

                    <input form="survey" type="radio" name="emotionHal" id="noHal" value="no">
                    <label for="noHal">No</label><br><br>

                    <b>Comments</b><br>
                    <textarea form="survey" rows="14" cols="55" id="commentHal" name="commentHal"></textarea><br>

                </div>

            </div>


            <!-- GOODBYE -->
            <div class="mySlides">
                <div class="greeting">Submit</div>
                <div class="start-text">
                    <p>
                        When you completed all questions, please click “Submit” and your data will be saved. <br>
                        You can return to the survey pages and review your rating if you wish.
                    </p>
                    <div class="start" onclick="submitForms()" id="submitButton">Submit</div>
                </div>
            </div>

        </div>

        <!-- Next/Previous buttons -->
        <div class="prev" onclick="plusSlides(-1)" id="prev">&#10094;</div>
        <div class="next" onclick="plusSlides(1)" id="next">&#10095;</div>


        <div class="iframe-container" id="bye">
            <div class="myWelcome" id="byeText">

                <div class="greeting">Thank You</div>
                <div class="start-text">
                    <p>
                       Thank you for taking part in our study and for submitting your survey data.
                    </p>
                </div>
            </div>

        </div>



        <!-- Script for dynamic behaviour -->
        <script>
        var slideIndex = 1;
        var welcomeIndex = 1;
        var random = new Array(document.getElementsByClassName("mySlides").length);

        //Setup Function
        function setup() {
            //display welcome screen
                document.getElementById("welcome").style.display = "block";
                document.getElementById("firstWelcome").style.display = "block";

            //fill the random array
            for (var i=0; i<random.length; i++) {
                random[i] = i;
            }

            //initialise Eliza
            start();

            //randomise the chatbot order
            shuffleBots();

        }

        // Initialize Firebase
        var config = {
            apiKey: "AIzaSyB0hCRQiEMe6IHuIjDdh0vufIMDaG9xyag",
            authDomain: "chatbotdatabase-da33b.firebaseapp.com",
            databaseURL: "https://chatbotdatabase-da33b.firebaseio.com",
            projectId: "chatbotdatabase-da33b",
            storageBucket: "chatbotdatabase-da33b.appspot.com",
            messagingSenderId: "510893789563"
        };
        firebase.initializeApp(config);

        //Randomise the chatbot order
        function shuffleBots() {
            var slides = document.getElementsByClassName("mySlides");
            var length = (slides.length - 1) / 2 ;
            var renumber = document.getElementsByClassName("numbertext");
            var j, x, i;


            for (i = length - 1; i > 0; i--) {
                j = Math.floor(Math.random() * (i + 1));
                x = random[2*i];
                random[2*i] = random[2*j];
                random[2*i+1] = random[2*i]+1;
                random[2*j] = x;
                random[2*j+1] = random[2*j] + 1;
                }

            //Number the bots in the right order
            for (i = 0; i<length; i++) {
                var j = i + 1;
                renumber[random[2*i]].innerHTML = "Entity " + j + "/" + length;
                renumber[random[2*i+1]].innerHTML = "Survey " + j + "/" + length;
            }

        }

        //Next Welcome screen
        function nextWelcome() {
            var i;
            welcomeIndex++;
            var slides = document.getElementsByClassName("myWelcome");

            for (i = 0; i < slides.length; i++) {
                    slides[i].style.display = "none";
                }
            slides[welcomeIndex-1].style.display = "block";

        }

        //Display the chat bots and survey
        function startStudy() {

        if(checkInfos()) {
            document.getElementById("welcome").style.display = "none";
            document.getElementById("warning1").style.display = "none";
            document.getElementById("bots").style.display = "block";
            document.getElementById("next").style.display = "block";
            showSlides(slideIndex);
        }
        else {
            document.getElementById("warning1").style.display = "block";
        }

        }

        //Check if all personal information have been entered
        function checkInfos() {

            for(var i=0;i<4;i++) {
                if(document.getElementById("survey").elements.item(i).checked == true) {
                    if (document.getElementById("survey").elements.item(5).checked == true || document.getElementById("survey").elements.item(6).checked == true )
                        {
                            return true;
                        }
                    else {return false;};
                }
                else if (document.getElementById("survey").elements.item(i).checked == false && i == 3) {
                    return false;
                }
            }


            return false;
        }


        //Next slide
        function plusSlides(n) {
            showSlides(slideIndex += n);

            }

        function currentSlide(n) {
            showSlides(slideIndex = n);
            }

        //Display Slides
        function showSlides(n) {
            var i;
            var slides = document.getElementsByClassName("mySlides");

            if (slideIndex > 1) {
                document.getElementById("prev").style.display = "block";
                }
            else {
                document.getElementById("prev").style.display = "none";
            }

           if (slideIndex < slides.length) {
                document.getElementById("next").style.display = "block";
                }
            else {
                document.getElementById("next").style.display = "none";
            }

            if (n > slides.length) {slideIndex = 1}
            if (n < 1) {slideIndex = slides.length}
            for (i = 0; i < slides.length; i++) {
                slides[random[i]].style.display = "none";
                }

            slides[random[slideIndex-1]].style.display = "block";

            }

        //Submit all survey forms at once

        var messagesRef = firebase.database().ref('data');

        function submitForms(){

              //Define length of data array, only ticked elements should count but ...elements.length gets the number of all elements
              var numberofelements = document.getElementById("survey").elements.length;
              var data = new Array (numberofelements - (document.getElementsByClassName("mySlides").length-1)/2 - 4);
              var j = 0;
                    for (var i = 0; i<numberofelements; i++) {

                        var currentItem = document.getElementById("survey").elements.item(i);
                        var nextItem = document.getElementById("survey").elements.item(i+1);

                        if(currentItem.checked == true || currentItem.tagName == "TEXTAREA" || currentItem.tagName == "SELECT") {
                            data[j] = currentItem.value;
                            if(!currentItem.value) {
                                data[j] = "-";
                            }
                            j++;
                        }
                        else {
                            if (currentItem.value >= 0)
                                {
                                    data[j] = currentItem.value;
                                    j++;
                                }
                            else if (currentItem.checked == false && nextItem.checked == false && i>6) {
                                    data[j] = "-";
                                    j++;
                                    i++;
                            }
                        }

                    }

            //Submit data to firebase
            var newMessageRef = messagesRef.push();
            newMessageRef.set(data);

            //Hide last
            document.getElementById("bots").style.display = "none";
            document.getElementById("next").style.display = "none";
            document.getElementById("prev").style.display = "none";


            //Show submit confirmation
            document.getElementById("bye").style.display = "block";
            document.getElementById("byeText").style.display = "block";
            
        }




        </script>
</body>
</html>




